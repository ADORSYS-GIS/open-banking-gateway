@startuml

autonumber "<b><color blue>[00]"
actor psu

box "PsuUserAgent" #LightGray
    participant "FinTechUI" as FinTechUI
    participant "ConsentAuthorisationUI" as ConsentAuthorisationUI
    participant "OnlineBankingUI" as OnlineBankingUI
end box
box "FinTechDC" #DarkSeaGreen
    participant "FinTechApi" as FinTechApi
end box
box "TppDC" #LightGray
    participant "TppBankingApi" as TppBankingApi
    participant "TppBankSearchApi" as TppBankSearchApi
    participant "ConsentAuthorisationApi" as ConsentAuthorisationApi

    participant "RedirectSessionStoreApi" as RedirectSessionStoreApi
    participant "BankingProtocol" as BankingProtocol
end box
box "AspspDC" #LightSkyBlue
	participant "AspspBankingApi" as AspspBankingApi
    participant "OnlineBankingApi" as OnlineBankingApi
end box

== Execute PSU transaction display request : call[header](body)<params> return code[header](body) ==

FinTechUI -> FinTechApi ++ : GET:FinTech-Redirect-URI[UserAgentContext,\nPsuConsentSessionCookie]()<redirectCode>
FinTechApi -> TppBankingApi ++ : GET:code2Token[UserAgentContext,\nPsuConsentSessionCookie]\n(redirectCode)<>
TppBankingApi -> RedirectSessionStoreApi ++ : redirectSession(redirectCode)
RedirectSessionStoreApi -> RedirectSessionStoreApi : loadDeryptDeleteRedirectSession\n(redirectCode):TppConsentSession
return TppConsentSession
TppBankingApi -> TppBankingApi: TppConsentSession.PsuConsentSession()
return PsuConsentSession
loop FinTech2TppConsentToken.isValid()
    FinTechApi -> TppBankingApi ++ : POST:listTransactions[PsuConsentSession](requestSpec)
    TppBankingApi -> BankingProtocol ++ : listTransactions[TppConsentSession]\n(requestSpec) 
    BankingProtocol -> AspspBankingApi ++ : listTransactions[TppContext](AisConsent, requestSpec) 
    return 200_OK[](Transactions)
    return 200_OK[](Transactions)
    return 200_OK[](Transactions)
end
return 200_OK[](Transactions)
FinTechUI --> psu : displayTransactions()
@enduml
